<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <title>Zemljopis</title>
    </head>
    <style>
        /*
        align-items center sa justify content center daje 'savrsen' centar u poziciranju
        @media only screen and (max-width: 1349.9px) and (min-width: 340px) {
             .myFlexContainer{
                 display:flex;
                 flex-direction: column;
                 justify-content: center;
                 align-items : center;
                 margin-left:20%;
                 margin-right: 20%;
                 margin-top:5%;
                 
             }
             .myFlexContainer > div{
                text-align: center;
                 margin-bottom : 1rem;
             }
             
             .myFlexContainer > div > select{
                 width:100%;
                 height: calc(1.5em + .75rem + 2px);
                 padding: .375rem .75rem;
                 font-size: 1rem;
                 font-weight: 400;
                 line-height: 1.5;
                 background-color: #fff;
                 border: 1px solid #ced4da;
                 border-radius: .25rem;
             }
             
        }*/
        @media only screen and (max-width: 1349.9px) {
            .myFlexContainer{
                display:flex;
                flex-direction: column;
                justify-content: center;
                margin-left:20%;
                margin-right: 20%;
                margin-top:10%;
                
            }
            .myFlexContainer > div{
                text-align: center;
                margin-bottom : 1rem;
            }
            .myFlexContainer > div > select{
                width:100%;
                height: calc(1.5em + .75rem + 2px);
                padding: .375rem .75rem;
                font-size: 1rem;
                font-weight: 400;
                line-height: 1.5;
                background-color: #fff;
                border: 1px solid #ced4da;
                border-radius: .25rem;
            }
            
       }
        @media only screen and (max-width: 339.9px) {
             .myFlexContainer{
                 display:flex;
                 flex-direction: column;
                 justify-content: center;
                 align-items : center;
                 margin-left:20%;
                 margin-right: 20%;
                 margin-top:5%;
                 
             }
             .myFlexContainer > div{
                 text-align: center;
                 margin-bottom : 1rem;
             }
             .myFlexContainer > div > select{
                 width:100%;
                 height: calc(1.5em + .75rem + 2px);
                 padding: .375rem .75rem;
                 font-size: 1rem;
                 font-weight: 400;
                 line-height: 1.5;
                 background-color: #fff;
                 border: 1px solid #ced4da;
                 border-radius: .25rem;
             }
             
        }
        @media only screen and (min-width : 1350px){
             .myFlexContainer{
                 display:flex;
                 flex-direction: row;
                 justify-content: center;
                 margin-left:16%;
                 margin-right: 16%;
                 margin-top:5%;
                 white-space:nowrap;
             }
             .myFlexContainer > div{
                 text-align: center;
                 
                 flex-basis: 0;
                 padding-right: 5px;
                 padding-left: 5px;
                 flex-grow: 1;
                 max-width: 100%;
                 
                 
             }
             .myFlexContainer > div > select{
                 height: calc(1.5em + .75rem + 2px);
                 padding: .375rem .75rem;
                 font-size: 1rem;
                 font-weight: 400;
                 line-height: 1.5;
                 background-color: #fff;
                 border: 1px solid #ced4da;
                 border-radius: .25rem;
             }
             .myFlexContainer > div >button{
                 font-weight: 400;
                 color: #fff;
                 text-align: center;
                 vertical-align: middle;
                 background-color:  #343a40;
                 border: 1px #343a40;
                 font-weight: 400;  
                 user-select: none;
                 font-size: 1rem;
                 line-height: 1.5;
                 border-radius: .25rem;
                 width:100%;
                 max-width: 100%;
                 
 
             }
                .myDiv{
                    display: flex;
                    flex-direction: row;
                    justify-content: center;
                }
                .myDiv > label{
                    text-align: center;
                    justify-content: center;
                    padding-top:5%;
                    padding-bottom:5%;
                }
                .myControl{
                    text-align: center;
                    justify-content: center;
                    width: 100%;
                    white-space:nowrap;
                    height: calc(1.5em + .75rem + 2px);
                    padding: .375rem .75rem;
                    font-size: 1rem;
                    font-weight: 400;
                    line-height: 1.5;
                    color: #495057;
                    background-color:white;
                    background-clip: padding-box;
                    border: 1px solid #ced4da;
                    border-radius: .25rem;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
             } 
             
        }
       
     </style>
    <body>
        
            <div class="alert alert-danger" id="danger-alert">
                    <!--<a href="#" class="close" data-dismiss="alert">&times;</a>-->
                    <strong>Success!</strong> Your message has been sent successfully.
                </div>
        <script>
            $("#danger-alert").hide(); 
            document.body.style.backgroundImage = `url(/public/images/bg2.jpg)`
        </script>
        <h1><center>Zemljopis</center></h1>
        <div class="myFlexContainer center">
            
            
                <div>
                    <input type="text" class="form-control" id="txb_roomCode" placeholder="Room..">
                </div>
                <div>
                    <input type="text" class="form-control" id="txb_username" placeholder="Name.." required>
                </div>
                <div>
                    <label for="roundTimeLimit">Player count : </label>
                    <select id="playerNumber">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                    </select>
                </div>     
                <div>
                    <label for="roundTimeLimit">Round time : </label>
                    <select id="roundTimeLimit">
                        <option>60</option>
                        <option>90</option>
                        <option>120</option>
                    </select>
                </div>  
                <div>
                        <button class="btn btn-dark" id="napravi">Create room</button>
                    </div>
                    <div>
                        <button class="btn btn-dark" id="pridruzi">Join the room</button>
                    </div>
                    <div>
                        <button class="btn btn-dark" id="vrati">Return to room</button>
                    </div>
                
            
            
            
        </div>  
        <!--<div class="input-group mb-3">
            <div class="input-group-prepend" style="margin-top:2%;margin-left:10%;margin-right:10%">
                <input id="txb" type='text' class='form-control'>    
                <button class='btn btn-dark' id='napravi'>Napravi sobu</button>
                <button class='btn btn-dark' id="pridruzi">Pridruži se</button>
            </div>
    </div>-->
    
    </body>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.4/qs.min.js" integrity="sha512-BHtomM5XDcUy7tDNcrcX1Eh0RogdWiMdXl3wJcKB3PFekXb3l5aDzymaTher61u6vEZySnoC/SAj2Y/p918Y3w==" crossorigin="anonymous"></script>
    <script src="../public/javascripts/config.js"></script>
    <script >
       
        /*
        let index = Math.floor(Math.random() * 2)
        document.body.style.backgroundImage = `url(/public/images/bg${index}.png)`
        setInterval(()=>{
        
        index ++ 
        if(index >2)
            index = 0

        document.body.style.backgroundImage = `url(/public/images/bg${index}.png)`
        },5000)
        */
                
            
        
        const serverAddress = serverAdress()
        const socket = io(serverAddress);
        const userReg = RegExp("[0-9A-Za-z]{4,30}\g");
        const roomReg = RegExp("[0-9A-Za-z]{8}\g")
        socket.on('message', message =>{
            console.log(message)
        })
        //TODO dodaj type reconnect 
        socket.on('createRoomSQLResponse',response =>{
            console.log(response)
            if(response["Success"] == false)
                myAlert('Doslo je do problema u kreiranju sobe, pokusajte ponovo!')
            else
            {
                localStorage.setItem('sessionToken',response['sessionToken'])
                console.log(response['sessionToken'])
                window.location.href = `/game?roomCode=${response['roomCode']}&username=${response['username']}`;

            }
        })
        socket.on('joinRoomSQLResponse' , response=>{
            
            if(response["Success"] == false)
                //make this more robust
                myAlert(response["ERR_MSG"])
            else
            {
                localStorage.setItem('sessionToken',response['sessionToken'])
                window.location.href = `/game?roomCode=${response['roomCode']}&username=${response['username']}`
            }
            
        })
        function myAlert(test){
            $("#danger-alert").html(`<a href="#" class="close" data-dismiss="alert">&times;</a><strong>Failure</strong> ${test}`)
            $("#danger-alert").fadeTo(7000, 500).slideUp(500, () =>{
                $("#danger-alert").slideUp(500);
            });   
        }
        

        //dodaj ova govna
        document.getElementById('pridruzi').addEventListener('click',(e)=>{
            let roomReg = /^[A-Za-z0-9]{8}$/g
            const usernameReg = /^[A-Za-zčČćĆžŽšŠđĐ ]{4,30}$/g
            e.preventDefault();
            let username = document.getElementById('txb_username').value.trim()
            let room = document.getElementById('txb_roomCode').value.trim()
            if(roomReg.test(room) && usernameReg.test(username)){                      
                socket.emit('joinRoomSQL',{username,room})                
                //pop alert
            }else{
                if(!roomReg.test(room) && !usernameReg.test(username)){
                    //mylaertuj za o
                    myAlert('Username minimal length of 4 characters only letters')
                }else if(!roomReg(room)){
                    // ako je soba invalidnog formata
                    myAlert('Room name is 8 characters long')
                }
                else{
                    //ako je useranme invalidnog formnata
                    myAlert('Korisnicko ime mora da bude barem 4 karaktera dugacko, dozvoljena pisma su sprska latinica i engleski alfabet!')
                }
            }
        })
       
        document.getElementById('napravi').addEventListener('click',(e)=>{
            e.preventDefault(); 
            let username = document.getElementById('txb_username').value.trim()
            let reg = /^[A-Za-zčČćĆžŽšŠđĐ ]{4,30}$/g
            if(reg.test(username)){
                let playerCount = document.getElementById('playerNumber').value

                console.log(typeof(playerCount));
                let roundTimeLimit = document.getElementById('roundTimeLimit').value
                /*if(userReg.test(username))
                    console.log("Napravi")
                    //socket.emit('createRoom',username)
                else
                    myAlert("Username must be longer than 4 and shorter than 30 characters, only numbers and letters")
                    //pop awlert
                */
                socket.emit('createRoom',{username,playerCount,roundTimeLimit})
            }else{
                myAlert("Username minimal length of 4 characters only letters")
            }
        })
        document.getElementById('vrati').addEventListener('click',(e)=>{
            e.preventDefault();
            let room = document.getElementById('txb_roomCode').value.trim()
            let username = document.getElementById('txb_username').value.trim()
            let roomReg = /^[A-Za-z0-9]{8}$/g
            const usernameReg = /^[A-Za-zčČćĆžŽšŠđĐ ]{4,30}$/g
            if(roomReg.test(room) && usernameReg.test(username)){   
                window.location.href = `/game?roomCode=${room}&username=${username}`;
            }else{
                if(!roomReg.test(room) && !usernameReg(username)){
                    //mylaertuj za o
                    myAlert('Username minimal length of 4 characters only letters')
                }else if(!roomReg(room)){
                    // ako je soba invalidnog formata
                    myAlert('Room name is 8 characters long')
                }
                else{
                    //ako je useranme invalidnog formnata
                    myAlert('Korisnicko ime mora da bude barem 4 karaktera dugacko, dozvoljena pisma su sprska latinica i engleski alfabet!')
                }
            }
        })
        
        /*
        document.getElementById('napravi').addEventListener('click',(e) =>{
            e.preventDefault()
            /*
            const {username, room} = Qs.parse(location.search,{
                ignoreQueryPrefix: true
            })
            
            //Join room
            
            
                
        })
              */  
    </script>
</html>